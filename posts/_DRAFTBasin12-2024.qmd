---
title: "DRAFT 2024 Basin 12 Water Quality Review"
author: "Ryan O'Donnell"
desription: "Three year summary of water quality results collected by Deerfield River Watershed Association volunteers"
date: "7/15/2024"
format:
  html:
    df-print: paged
    toc: true
    echo: false
    warning: false
categories:
  - Deerfield River
  - North River
  - Green River
  - Beaver Brook
  - Whetstone Brook
  - Broad Brook
  - Chloride
  - Nitrogen
  - Phosphorus
  - Bacteria
  - E. coli
  - Turbidity
  - Conductivity
  - Tributaries
  - Basin 12
  - Vermont
---

```{r library}

library(tidyverse)
library(readxl)
library(lubridate)
library(maps)
library(mapproj)
library(sf)
library(patchwork)
library(ggiraph)
library(maps)
library(mapproj)
library(ggtext)
library(scales)
library(htmlwidgets)
library(gt)
library(EnvStats)

```

```{r data}

Basin12 <- read_xlsx("_data/24Basin12Data.xlsx") %>%
  separate(`SiteID`, c("State", "River", "Mile"), sep = "-|_", remove = FALSE) %>%
  drop_na(ResultValue) %>%
  mutate(
    Mile = as.numeric(Mile),
    ResultCalc = case_when(
      str_detect(ResultValue, "<") ~ parse_number(ResultValue)/2,
      str_detect(ResultValue, ">") ~ parse_number(ResultValue),
      TRUE ~ as.numeric(ResultValue)
    ),
    Group = case_when(
      River == "BRD" ~ "CT River Tributaries",
      River == "BVR" ~ "Deerfield Tributaries",
      River == "EBN" ~ "North River",
      River == "NBD" ~ "North Branch Deerfield River",
      River == "NWT" ~ "CT River Tributaries",
      River == "ELS" ~ "Deerfield Tributaries",
      River == "WET" ~ "Whetstone Brook",
      River == "GRN" ~ "Green River",
      River == "COB" ~ "Deerfield Tributaries",
      River == "PND" ~ "Green Tributaries",
      River == "HBG" ~ "Green Tributaries",
      River == "NEG" ~ "Deerfield Tributaries"
    ),
    WeatherStatus = case_when(
      WeatherStatus == "Y" ~ "Wet",
      WeatherStatus == "N" ~ "Dry",
      TRUE ~ WeatherStatus
    ),
    "SampleYear" = as.character(year(SampleDate)),
      SiteID = case_when(
      SiteID == "VT-ELS_00.2" & SampleYear < 2023 ~ "VT-NEG_00.2",
      TRUE ~ SiteID
    )) %>%
  rename(ChartName = `Chart Name`)

wetdry_colors <- c("Dry" = "#44AA99", "Wet" = "#554499")
lmh_colors <- c("Low" = "#88CCEE", "Moderate" = "#DDCC77", "High" = "#CC6677")
standardcolor <- "#AA4499"
standardcolor2 <- "#442222"

watersheds <- unique(Basin12$Group)
```

INTRO

# Basin 12 Overview

## Volunteer Water Quality Monitoring History

### Monitoring Locations

### Parameters

# Monitoring Results

## Bacteria
```{r bacteria set-up}

bacteria_data <- Basin12 %>%
  filter(Parameter == "E. coli") %>%
  filter(SiteID != "VT-NWT_01.0") %>%
  filter(SiteID != "VT-NBD_12.5") %>%
  filter(SiteID != "VT-NBD_01.3")

ECmax <- max(bacteria_data$ResultCalc)

swim_limit = 235

```

::: {.panel-tabset group="watershed"}

```{r bacteria graphs}
#| output: asis
#| echo: false

res <- purrr::map_chr(watersheds, \(.watershed) {
    knitr::knit_child(
      input = "_childcodes/_B12_EC.qmd", 
      envir = environment(), 
      quiet = TRUE
      )
  })

cat(res, sep = '\n\n')
```

:::

## Nutrients
```{r nutrients set-up}

nutrient_data <- Basin12 %>%
  filter(Parameter %in% c("Total Nitrogen", "Total Phosphorus")) %>%
  filter(SiteID != "VT-NBD_01.3")

TNmax <- nutrient_data %>%
  filter(Parameter == "Total Nitrogen")

TNmax <- max(TNmax$ResultCalc)

TN_standard <- 0.38

TPmax <- nutrient_data %>%
  filter(Parameter == "Total Phosphorus")

TPmax <- max(TPmax$ResultCalc)

TP_standardA1 <- 9
TP_standardB2 <- 15

```

::: {.panel-tabset group="watershed"}

```{r nutrient graphs}
#| output: asis
#| echo: false

res <- purrr::map_chr(watersheds, \(.watershed) {
    knitr::knit_child(
      input = "_childcodes/_B12_nutrient.qmd", 
      envir = environment(), 
      quiet = TRUE
      )
  })

cat(res, sep = '\n\n')
```

:::

## Chloride/Conductivity

## Turbidity

## Discussion

## 


# Next Steps

# Complete Results